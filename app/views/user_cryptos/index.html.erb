<header>
  <script src="https://kit.fontawesome.com/068a9d7e61.js"></script>
</header>
<% unless @cryptos == nil %>
  <% n = -1 %>
  <% @total = 0 %>
  <% @total_coin = 0 %>

  <table class="table">
    <thead>
      <tr class="text-dark">
        <h1><th scope="col">rank</th>
        <th scope="col">Symbol</th>
        <th scope="col">Name</th>
        <th scope="col">Price</th>
        <th scope="col">Quantity</th>
      <th scope="col"> Total </th>
        <th scope="col"> 1h Change </th>
        <th scope="col"> 24h Change </th>
      <th scope="col"> 7 day Change </th></h1>

      <th scope ="col"> 7 day chart  </th>
            <th scope ="col">  </th>
      </tr>
    </thead>
      <% @cryptos.each do |crypto| %>

      <% crypto_currency = current_user.user_cryptos.find_by(crypto_currency: crypto) %>
            <% n += 1 %>
      <%  @url = 'https://api.coinlore.com/api/ticker/?id=' + crypto.crypto_id.to_s %>
      <% @coin = api_request(@url) %>
      <% @coin.each do |coin| %>



      <tbody>
            <tr>
              <td class="text-dark"><%= coin['rank'] %></td>
                <% symbol = coin_symbol_helper_check(coin['symbol']) %>
              <td> <img  class ="cryptolist-logo " alt ="x" <%= image_tag("https://chasing-coins.com/coin/logo/#{symbol}")  %>  </td>
              <td >   	<%= link_to crypto.name, crypto_currency_path(crypto.crypto_id) %><br> </td>
              <% price = coin['price_usd'] %>
              <% if price.to_f > 500 %>
              <td>  <%= number_to_currency(price, precision: 0, delimiter: " ") %>  </td>
              <% elsif price.to_f < 0.01 %>
              <td>  <%= number_to_currency(price, precision: 4, delimiter: " ") %>  </td>
              <% else %>
              <td>  <%= number_to_currency(price, precision: 2, delimiter: " ") %>  </td>
              <% end %>
              <td>

            	<%= form_tag user_crypto_path(crypto.crypto_id),:method => :put do %>
              <%= text_field_tag 'quantity', crypto_currency.quantity.to_s%>
                                <%= submit_tag "Update" %>
                <% end %>
          </td>
          <% if crypto_currency.quantity != nil %>
                <td>  <% @total_coin = (price.to_f * crypto_currency.quantity) %>
                <%= number_to_currency(@total_coin, precision: 0, delimiter: " ") %></td>
              <% end %>
              <% if coin["percent_change_1h"].to_f > 0 %>
                 <td class="green" ><%= coin["percent_change_1h"]%>% <i class="fas fa-caret-up"></i></td>
              <% else %>
               <td class="red" ><%= coin["percent_change_1h"]%>% <i class="fas fa-caret-down" ></i></td>
                <%end%>
              <% if coin["percent_change_24h"].to_f > 0 %>
               <td class="green" ><%= coin["percent_change_24h"]%>% <i class="fas fa-caret-up"></i></td>
              <% else %>
               <td class="red" ><%= coin["percent_change_24h"]%>% <i class="fas fa-caret-down"></i></td>
              <%end%>
              <% if coin["percent_change_7d"].to_f > 0 %>
               <td class="green" ><%= coin["percent_change_7d"]%>% <i class="fas fa-caret-up"></i></td>
              <% else %>
               <td class="red" ><%= coin["percent_change_7d"]%>% <i class="fas fa-caret-down"></i></td>
              <%end%>
              <% coin_name = coin["symbol"].downcase +  "-" + coin["name"].downcase.gsub(/\s+/, "-") %>
              <%    coin_name = coin_name_chart_helper_check(coin_name) %>

                    <td class=> <%= image_tag("https://graphs2.coinpaprika.com/currency/chart/#{coin_name}/7d/chart.svg")  %></td>

                <td> 	<%= link_to "x", user_crypto_path(crypto_currency.id), :method => :delete,data: { confirm: 'Are you sure to delete '+crypto.name+ " to your portfolio?"} %></td>
              </tr>
                </tbody>

    <% end %>
              <% @total += @total_coin %>

  <% end %>

                    </table>

                  <center>  <h1> TOTAL:     <%= number_to_currency((@total) , precision: 0, delimiter: " ") %> </h1> </center>
<% end %>
